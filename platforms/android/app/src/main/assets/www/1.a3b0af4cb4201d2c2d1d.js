(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{PpLr:function(t,e,n){"use strict";n.d(e,"a",function(){return o});var o=function(){}},"S+eF":function(t,e,n){!function(e){"use strict";"function"==typeof bootstrap?bootstrap("promise",e):t.exports=e()}(function(){"use strict";var t=!1;try{throw new Error}catch(e){t=!!e.stack}var e,n=b(),o=function(){},r=function(){var t={task:void 0,next:null},e=t,n=!1,o=void 0,i=!1,s=[];function u(){for(var e,o;t.next;)e=(t=t.next).task,t.task=void 0,(o=t.domain)&&(t.domain=void 0,o.enter()),a(e,o);for(;s.length;)a(e=s.pop());n=!1}function a(t,e){try{t()}catch(t){if(i)throw e&&e.exit(),setTimeout(u,0),e&&e.enter(),t;setTimeout(function(){throw t},0)}e&&e.exit()}if(r=function(t){e=e.next={task:t,domain:i&&process.domain,next:null},n||(n=!0,o())},"object"==typeof process&&"[object process]"===process.toString()&&process.nextTick)i=!0,o=function(){process.nextTick(u)};else if("function"==typeof setImmediate)o="undefined"!=typeof window?setImmediate.bind(window,u):function(){setImmediate(u)};else if("undefined"!=typeof MessageChannel){var c=new MessageChannel;c.port1.onmessage=function(){o=l,c.port1.onmessage=u,u()};var l=function(){c.port2.postMessage(0)};o=function(){setTimeout(u,0),l()}}else o=function(){setTimeout(u,0)};return r.runAfter=function(t){s.push(t),n||(n=!0,o())},r}(),i=Function.call;function s(t){return function(){return i.apply(t,arguments)}}var u,a=s(Array.prototype.slice),c=s(Array.prototype.reduce||function(t,e){var n=0,o=this.length;if(1===arguments.length)for(;;){if(n in this){e=this[n++];break}if(++n>=o)throw new TypeError}for(;n<o;n++)n in this&&(e=t(e,this[n],n));return e}),l=s(Array.prototype.indexOf||function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1}),f=s(Array.prototype.map||function(t,e){var n=this,o=[];return c(n,function(r,i,s){o.push(t.call(e,i,s,n))},void 0),o}),p=Object.create||function(t){function e(){}return e.prototype=t,new e},d=s(Object.prototype.hasOwnProperty),h=Object.keys||function(t){var e=[];for(var n in t)d(t,n)&&e.push(n);return e},v=s(Object.prototype.toString);u="undefined"!=typeof ReturnValue?ReturnValue:function(t){this.value=t};var y="From previous event:";function m(e,n){if(t&&n.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(y)){for(var o=[],r=n;r;r=r.source)r.stack&&o.unshift(r.stack);o.unshift(e.stack);var i=o.join("\n"+y+"\n");e.stack=function(t){for(var e=i.split("\n"),n=[],o=0;o<e.length;++o){var r=e[o];!w(r)&&-1===(s=r).indexOf("(module.js:")&&-1===s.indexOf("(node.js:")&&r&&n.push(r)}var s;return n.join("\n")}()}}function g(t){var e=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);if(e)return[e[1],Number(e[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(t);if(n)return[n[1],Number(n[2])];var o=/.*@(.+):(\d+)$/.exec(t);return o?[o[1],Number(o[2])]:void 0}function w(t){var o=g(t);if(!o)return!1;var r=o[1];return o[0]===e&&r>=n&&r<=G}function b(){if(t)try{throw new Error}catch(t){var n=t.stack.split("\n"),o=g(n[0].indexOf("@")>0?n[1]:n[2]);if(!o)return;return e=o[0],o[1]}}function k(t){return t instanceof V?t:C(t)?(e=t,n=T(),k.nextTick(function(){try{e.then(n.resolve,n.reject,n.notify)}catch(t){n.reject(t)}}),n.promise):Z(t);var e,n}function T(){var e,n=[],o=[],r=p(T.prototype),i=p(V.prototype);if(i.promiseDispatch=function(t,r,i){var s=a(arguments);n?(n.push(s),"when"===r&&i[1]&&o.push(i[1])):k.nextTick(function(){e.promiseDispatch.apply(e,s)})},i.valueOf=function(){if(n)return i;var t=I(e);return R(t)&&(e=t),t},i.inspect=function(){return e?e.inspect():{state:"pending"}},k.longStackSupport&&t)try{throw new Error}catch(t){i.stack=t.stack.substring(t.stack.indexOf("\n")+1)}function s(t){e=t,i.source=t,c(n,function(e,n){k.nextTick(function(){t.promiseDispatch.apply(t,n)})},void 0),n=void 0,o=void 0}return r.promise=i,r.resolve=function(t){e||s(k(t))},r.fulfill=function(t){e||s(Z(t))},r.reject=function(t){e||s(M(t))},r.notify=function(t){e||c(o,function(e,n){k.nextTick(function(){n(t)})},void 0)},r}function j(t){if("function"!=typeof t)throw new TypeError("resolver must be a function.");var e=T();try{t(e.resolve,e.reject,e.notify)}catch(t){e.reject(t)}return e.promise}function x(t){return j(function(e,n){for(var o=0,r=t.length;o<r;o++)k(t[o]).then(e,n)})}function V(t,e,n){void 0===e&&(e=function(t){return M(new Error("Promise does not support operation: "+t))}),void 0===n&&(n=function(){return{state:"unknown"}});var o=p(V.prototype);if(o.promiseDispatch=function(n,r,i){var s;try{s=t[r]?t[r].apply(o,i):e.call(o,r,i)}catch(t){s=M(t)}n&&n(s)},o.inspect=n,n){var r=n();"rejected"===r.state&&(o.exception=r.reason),o.valueOf=function(){var t=n();return"pending"===t.state||"rejected"===t.state?o:t.value}}return o}function S(t,e,n,o){return k(t).then(e,n,o)}function I(t){if(R(t)){var e=t.inspect();if("fulfilled"===e.state)return e.value}return t}function R(t){return t instanceof V}function C(t){return(e=t)===Object(e)&&"function"==typeof t.then;var e}k.resolve=k,k.nextTick=r,k.longStackSupport=!1,"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(k.longStackSupport=!0),k.defer=T,T.prototype.makeNodeResolver=function(){var t=this;return function(e,n){e?t.reject(e):t.resolve(arguments.length>2?a(arguments,1):n)}},k.Promise=j,k.promise=j,j.race=x,j.all=N,j.reject=M,j.resolve=k,k.passByCopy=function(t){return t},V.prototype.passByCopy=function(){return this},k.join=function(t,e){return k(t).join(e)},V.prototype.join=function(t){return k([this,t]).spread(function(t,e){if(t===e)return t;throw new Error("Can't join: not the same: "+t+" "+e)})},k.race=x,V.prototype.race=function(){return this.then(k.race)},k.makePromise=V,V.prototype.toString=function(){return"[object Promise]"},V.prototype.then=function(t,e,n){var o=this,r=T(),i=!1;return k.nextTick(function(){o.promiseDispatch(function(e){i||(i=!0,r.resolve(function(e){try{return"function"==typeof t?t(e):e}catch(t){return M(t)}}(e)))},"when",[function(t){i||(i=!0,r.resolve(function(t){if("function"==typeof e){m(t,o);try{return e(t)}catch(t){return M(t)}}return M(t)}(t)))}])}),o.promiseDispatch(void 0,"when",[void 0,function(t){var e,o=!1;try{e=function(t){return"function"==typeof n?n(t):t}(t)}catch(t){if(o=!0,!k.onerror)throw t;k.onerror(t)}o||r.notify(e)}]),r.promise},k.tap=function(t,e){return k(t).tap(e)},V.prototype.tap=function(t){return t=k(t),this.then(function(e){return t.fcall(e).thenResolve(e)})},k.when=S,V.prototype.thenResolve=function(t){return this.then(function(){return t})},k.thenResolve=function(t,e){return k(t).thenResolve(e)},V.prototype.thenReject=function(t){return this.then(function(){throw t})},k.thenReject=function(t,e){return k(t).thenReject(e)},k.nearer=I,k.isPromise=R,k.isPromiseAlike=C,k.isPending=function(t){return R(t)&&"pending"===t.inspect().state},V.prototype.isPending=function(){return"pending"===this.inspect().state},k.isFulfilled=function(t){return!R(t)||"fulfilled"===t.inspect().state},V.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},k.isRejected=function(t){return R(t)&&"rejected"===t.inspect().state},V.prototype.isRejected=function(){return"rejected"===this.inspect().state};var P,L=[],O=[],D=[],E=!0;function A(){L.length=0,O.length=0,E||(E=!0)}function M(t){var e=V({when:function(e){return e&&function(t){if(E){var e=l(O,t);-1!==e&&("object"==typeof process&&"function"==typeof process.emit&&k.nextTick.runAfter(function(){var n=l(D,t);-1!==n&&(process.emit("rejectionHandled",L[e],t),D.splice(n,1))}),O.splice(e,1),L.splice(e,1))}}(this),e?e(t):this}},function(){return this},function(){return{state:"rejected",reason:t}});return function(t,e){E&&("object"==typeof process&&"function"==typeof process.emit&&k.nextTick.runAfter(function(){-1!==l(O,t)&&(process.emit("unhandledRejection",e,t),D.push(t))}),O.push(t),L.push(e&&void 0!==e.stack?e.stack:"(no stack) "+e))}(e,t),e}function Z(t){return V({when:function(){return t},get:function(e){return t[e]},set:function(e,n){t[e]=n},delete:function(e){delete t[e]},post:function(e,n){return null===e||void 0===e?t.apply(void 0,n):t[e].apply(t,n)},apply:function(e,n){return t.apply(e,n)},keys:function(){return h(t)}},void 0,function(){return{state:"fulfilled",value:t}})}function U(t,e,n){return k(t).spread(e,n)}function B(t,e,n){return k(t).dispatch(e,n)}function N(t){return S(t,function(t){var e=0,n=T();return c(t,function(o,r,i){var s;R(r)&&"fulfilled"===(s=r.inspect()).state?t[i]=s.value:(++e,S(r,function(o){t[i]=o,0==--e&&n.resolve(t)},n.reject,function(t){n.notify({index:i,value:t})}))},void 0),0===e&&n.resolve(t),n.promise})}function q(t){if(0===t.length)return k.resolve();var e=k.defer(),n=0;return c(t,function(o,r,i){n++,S(t[i],function(t){e.resolve(t)},function(){0==--n&&e.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))},function(t){e.notify({index:i,value:t})})},void 0),e.promise}function F(t){return S(t,function(t){return t=f(t,k),S(N(f(t,function(t){return S(t,o,o)})),function(){return t})})}k.resetUnhandledRejections=A,k.getUnhandledReasons=function(){return L.slice()},k.stopUnhandledRejectionTracking=function(){A(),E=!1},A(),k.reject=M,k.fulfill=Z,k.master=function(t){return V({isDef:function(){}},function(e,n){return B(t,e,n)},function(){return k(t).inspect()})},k.spread=U,V.prototype.spread=function(t,e){return this.all().then(function(e){return t.apply(void 0,e)},e)},k.async=function(t){return function(){function e(t,e){var i;if("undefined"==typeof StopIteration){try{i=n[t](e)}catch(t){return M(t)}return i.done?k(i.value):S(i.value,o,r)}try{i=n[t](e)}catch(t){return function(t){return"[object StopIteration]"===v(t)||t instanceof u}(t)?k(t.value):M(t)}return S(i,o,r)}var n=t.apply(this,arguments),o=e.bind(e,"next"),r=e.bind(e,"throw");return o()}},k.spawn=function(t){k.done(k.async(t)())},k.return=function(t){throw new u(t)},k.promised=function(t){return function(){return U([this,N(arguments)],function(e,n){return t.apply(e,n)})}},k.dispatch=B,V.prototype.dispatch=function(t,e){var n=this,o=T();return k.nextTick(function(){n.promiseDispatch(o.resolve,t,e)}),o.promise},k.get=function(t,e){return k(t).dispatch("get",[e])},V.prototype.get=function(t){return this.dispatch("get",[t])},k.set=function(t,e,n){return k(t).dispatch("set",[e,n])},V.prototype.set=function(t,e){return this.dispatch("set",[t,e])},k.del=k.delete=function(t,e){return k(t).dispatch("delete",[e])},V.prototype.del=V.prototype.delete=function(t){return this.dispatch("delete",[t])},k.mapply=k.post=function(t,e,n){return k(t).dispatch("post",[e,n])},V.prototype.mapply=V.prototype.post=function(t,e){return this.dispatch("post",[t,e])},k.send=k.mcall=k.invoke=function(t,e){return k(t).dispatch("post",[e,a(arguments,2)])},V.prototype.send=V.prototype.mcall=V.prototype.invoke=function(t){return this.dispatch("post",[t,a(arguments,1)])},k.fapply=function(t,e){return k(t).dispatch("apply",[void 0,e])},V.prototype.fapply=function(t){return this.dispatch("apply",[void 0,t])},k.try=k.fcall=function(t){return k(t).dispatch("apply",[void 0,a(arguments,1)])},V.prototype.fcall=function(){return this.dispatch("apply",[void 0,a(arguments)])},k.fbind=function(t){var e=k(t),n=a(arguments,1);return function(){return e.dispatch("apply",[this,n.concat(a(arguments))])}},V.prototype.fbind=function(){var t=this,e=a(arguments);return function(){return t.dispatch("apply",[this,e.concat(a(arguments))])}},k.keys=function(t){return k(t).dispatch("keys",[])},V.prototype.keys=function(){return this.dispatch("keys",[])},k.all=N,V.prototype.all=function(){return N(this)},k.any=q,V.prototype.any=function(){return q(this)},k.allResolved=(P=F,function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn("allResolved is deprecated, use allSettled instead.",new Error("").stack),P.apply(P,arguments)}),V.prototype.allResolved=function(){return F(this)},k.allSettled=function(t){return k(t).allSettled()},V.prototype.allSettled=function(){return this.then(function(t){return N(f(t,function(t){function e(){return t.inspect()}return(t=k(t)).then(e,e)}))})},k.fail=k.catch=function(t,e){return k(t).then(void 0,e)},V.prototype.fail=V.prototype.catch=function(t){return this.then(void 0,t)},k.progress=function(t,e){return k(t).then(void 0,void 0,e)},V.prototype.progress=function(t){return this.then(void 0,void 0,t)},k.fin=k.finally=function(t,e){return k(t).finally(e)},V.prototype.fin=V.prototype.finally=function(t){return t=k(t),this.then(function(e){return t.fcall().then(function(){return e})},function(e){return t.fcall().then(function(){throw e})})},k.done=function(t,e,n,o){return k(t).done(e,n,o)},V.prototype.done=function(t,e,n){var o=function(t){k.nextTick(function(){if(m(t,r),!k.onerror)throw t;k.onerror(t)})},r=t||e||n?this.then(t,e,n):this;"object"==typeof process&&process&&process.domain&&(o=process.domain.bind(o)),r.then(void 0,o)},k.timeout=function(t,e,n){return k(t).timeout(e,n)},V.prototype.timeout=function(t,e){var n=T(),o=setTimeout(function(){e&&"string"!=typeof e||((e=new Error(e||"Timed out after "+t+" ms")).code="ETIMEDOUT"),n.reject(e)},t);return this.then(function(t){clearTimeout(o),n.resolve(t)},function(t){clearTimeout(o),n.reject(t)},n.notify),n.promise},k.delay=function(t,e){return void 0===e&&(e=t,t=void 0),k(t).delay(e)},V.prototype.delay=function(t){return this.then(function(e){var n=T();return setTimeout(function(){n.resolve(e)},t),n.promise})},k.nfapply=function(t,e){return k(t).nfapply(e)},V.prototype.nfapply=function(t){var e=T(),n=a(t);return n.push(e.makeNodeResolver()),this.fapply(n).fail(e.reject),e.promise},k.nfcall=function(t){var e=a(arguments,1);return k(t).nfapply(e)},V.prototype.nfcall=function(){var t=a(arguments),e=T();return t.push(e.makeNodeResolver()),this.fapply(t).fail(e.reject),e.promise},k.nfbind=k.denodeify=function(t){var e=a(arguments,1);return function(){var n=e.concat(a(arguments)),o=T();return n.push(o.makeNodeResolver()),k(t).fapply(n).fail(o.reject),o.promise}},V.prototype.nfbind=V.prototype.denodeify=function(){var t=a(arguments);return t.unshift(this),k.denodeify.apply(void 0,t)},k.nbind=function(t,e){var n=a(arguments,2);return function(){var o=n.concat(a(arguments)),r=T();return o.push(r.makeNodeResolver()),k(function(){return t.apply(e,arguments)}).fapply(o).fail(r.reject),r.promise}},V.prototype.nbind=function(){var t=a(arguments,0);return t.unshift(this),k.nbind.apply(void 0,t)},k.nmapply=k.npost=function(t,e,n){return k(t).npost(e,n)},V.prototype.nmapply=V.prototype.npost=function(t,e){var n=a(e||[]),o=T();return n.push(o.makeNodeResolver()),this.dispatch("post",[t,n]).fail(o.reject),o.promise},k.nsend=k.nmcall=k.ninvoke=function(t,e){var n=a(arguments,2),o=T();return n.push(o.makeNodeResolver()),k(t).dispatch("post",[e,n]).fail(o.reject),o.promise},V.prototype.nsend=V.prototype.nmcall=V.prototype.ninvoke=function(t){var e=a(arguments,1),n=T();return e.push(n.makeNodeResolver()),this.dispatch("post",[t,e]).fail(n.reject),n.promise},k.nodeify=function(t,e){return k(t).nodeify(e)},V.prototype.nodeify=function(t){if(!t)return this;this.then(function(e){k.nextTick(function(){t(null,e)})},function(e){k.nextTick(function(){t(e)})})},k.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var G=b();return k})},dZuI:function(t,e,n){"use strict";n.d(e,"a",function(){return g});var o=n("iqUP"),r=(n("OO+k"),n("Rt4g")),i=n("TpLW"),s=n("B6Tt"),u=n("qNh5"),a=n("qyVB"),c=n("S+eF"),l=n("CcnG"),f=n("CssM"),p=n("9opb"),d=n("Eq7r"),h=n("tXrQ"),v=n("YxxD"),y=function(t,e,n,o){return new(n||(n=Promise))(function(r,i){function s(t){try{a(o.next(t))}catch(t){i(t)}}function u(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(s,u)}a((o=o.apply(t,e||[])).next())})},m=function(t,e){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},g=function(){function t(t,e,n,o,r,i,s,u,a,c){this.alertService=t,this.videoService=e,this.modalCtrl=n,this.LoadingCtrl=o,this.authService=r,this.profileService=i,this.maestroService=s,this.playlistService=u,this.navCtrl=a,this.plateform=c,this.firstLoad=!1,this.displayTopVideos=0,this.videosLast=[],this.topVideos=new Array,this.selections=new Array,this.loadiTop=!1,this.loadiMaestros=!1,this.loadiSelections=!1,this.role="visitor",this.offsetAll=0,this.videosWatched=[],this.maestros=new Array,this.favoritesMaestros=new Array,this.loadMaestroInfos=!1,this.loadProfileInfos=!1,this.user=[]}return t.prototype.initPage=function(){return y(this,void 0,void 0,function(){var t,e,n,r=this;return m(this,function(i){switch(i.label){case 0:return 0!=this.firstLoad?[3,10]:[4,this.LoadingCtrl.create({message:"Loading many stuff, Tangofury will be ready soon !"})];case 1:return[4,(t=i.sent()).present()];case 2:return i.sent(),e=(new Date).getTime(),[4,this.maestroService.loadMaestros(new Date).then(function(){r.loadMaestroInfos=!0;var t=(new Date).getTime()-e;console.log("maestro termine "+t),Object(c.resolve)(r.loadMaestroInfos)})];case 3:return i.sent(),n=o.storage(),this.playlistService.getSelections().then(function(t){t.forEach(function(t){n.ref("selections/"+t.image).getDownloadURL().then(function(e){t.image=e,r.selections.push(t)});var o=(new Date).getTime()-e;console.log("selection termine "+o),Object(c.resolve)(r.selections)})}),[4,this.videoService.getVideos(null,null,0,!0).then(function(t){r.videoService.setTopVideos(t);var n=(new Date).getTime()-e;console.log("top videos done "+n)})];case 4:return i.sent(),[4,this.profileService.getUserData().then(function(t){if(t){r.user=t,r.userId=t.key,r.profileService.setRole(t.role);var n=(new Date).getTime()-e;console.log("loading user ok "+n),r.profileService.logConnexion()}else r.profileService.setRole("visitor")})];case 5:return i.sent(),"visitor"==this.profileService.retrieveRole()?[3,8]:[4,this.maestroService.LoadListFavorites(this.user).then(function(t){r.maestroService.setFavoritesMaestros(t);var n=(new Date).getTime()-e;console.log("loading favs ok "+n)})];case 6:return i.sent(),[4,this.profileService.loadVideosWatched(this.profileService.retrieveUserId()).then(function(){var t=(new Date).getTime()-e;console.log("loading video watched ok "+t)})];case 7:i.sent(),i.label=8;case 8:return[4,t.dismiss()];case 9:i.sent(),i.label=10;case 10:return this.firstLoad=!0,[2,"finish"]}})})},t.prototype.tfIsLoaded=function(){return this.firstLoad},t.prototype.reInitFirstLoad=function(){this.firstLoad=!1},t.prototype.presentAlert=function(){return y(this,void 0,void 0,function(){return m(this,function(t){switch(t.label){case 0:return[4,this.alertService.create({header:"Do you like Tango Fury ?",message:"Give your advice on Google Play to help Tango Fury to grow up !",buttons:[{text:"Yes ! :)",handler:function(){window.open("https://play.google.com/e/apps/details?id=tango.fury")}},{text:"Cancel",role:"cancel",handler:function(){console.log("Cancel clicked")}}]})];case 1:return[4,t.sent().present()];case 2:return t.sent(),[2]}})})},t.ngInjectableDef=l.V({factory:function(){return new t(l.Z(f.a),l.Z(a.a),l.Z(p.a),l.Z(d.a),l.Z(u.a),l.Z(i.a),l.Z(r.a),l.Z(s.a),l.Z(h.a),l.Z(v.a))},token:t,providedIn:"root"}),t}()},qyVB:function(t,e,n){"use strict";n.d(e,"a",function(){return c}),n("OO+k");var o=n("iqUP"),r=n("TpLW"),i=n("Rt4g"),s=n("CcnG"),u=n("Eq7r"),a=n("YxxD"),c=function(){function t(t,e,n,o){this.loadingCtrl=t,this.profileService=e,this.maestroService=n,this.platform=o,this.videos=new Array,this.topVideos=[],this.allVideos=[],this.allMilongas=[],this.allVals=[],this.allOthers=[],this.allLessons=[],this.limitOffset=12}return t.prototype.launchVideo=function(t){window.open("https://www.youtube.com/watch?v="+t.youtubeId)},t.prototype.getVideos=function(t,e,n,r){var i=this;return void 0===e&&(e=""),void 0===n&&(n=0),void 0===r&&(r=!1),new Promise(function(s){if(null==t)if(null==e)if(1==r)var u=o.database().ref("/videos").orderByChild("topVideo").equalTo(1).limitToLast(n+12);else u=o.database().ref("/videos").orderByChild("datePublication").limitToLast(n+12);else u=o.database().ref("/videos").orderByChild("type").equalTo(e).limitToLast(n+12);else u=null==e?o.database().ref("maestros/"+t.key+"/videos").orderByChild("datePublication").limitToLast(n+12):o.database().ref("maestros/"+t.key+"/videos").orderByChild("type").equalTo(e).limitToLast(n+12);var a=i.profileService.getVideosWatched();u.once("value").then(function(t){var e=[];t.forEach(function(t){var n={key:t.key,id:t.child("id").val(),title:t.child("title").val(),youtubeId:t.child("youtubeId").val(),urlImage:t.child("urlImage").val(),datePublication:t.child("datePublication").val(),description:t.child("description").val(),importUser:t.child("importUser").val(),topVideo:t.child("topVideo").val(),type:t.child("type").val(),valid:t.child("valid").val(),dateAdd:t.child("dateAdd").val(),seen:!1};a.indexOf(n.youtubeId)>-1&&(n.seen=!0),n.valid&&e.push(n)}),s(e.length>0?e.reverse():[])})})},t.prototype.loadAllVideos=function(){var t=this;return new Promise(function(e,n){o.database().ref("/videos").orderByChild("datePublication").once("value").then(function(n){var o=[],r=[];n.forEach(function(t){var e={key:t.key,id:t.child("id").val(),title:t.child("title").val(),youtubeId:t.child("youtubeId").val(),urlImage:t.child("urlImage").val(),datePublication:t.child("datePublication").val(),description:t.child("description").val(),importUser:t.child("importUser").val(),topVideo:t.child("topVideo").val(),type:t.child("type").val(),valid:t.child("valid").val(),dateAdd:t.child("dateAdd").val(),seen:!1};e.valid&&(o.push(e),e.topVideo&&r.push(e))}),o.length>0?(t.allVideos=o,t.topVideos=r,t.allVideos.reverse(),e(t.allVideos)):e(null)})})},t.prototype.addToVideos=function(t){this.allVideos.unshift(t)},t.prototype.setVideos=function(t){this.allVideos=t;for(var e=0,n=this.allVideos;e<n.length;e++){var o=n[e];"milonga"==o.type&&this.allMilongas.push(o),"vals"==o.type&&this.allVals.push(o),"other"==o.type&&this.allOthers.push(o),"lesson"==o.type&&this.allLessons.push(o)}},t.prototype.getAllVideos=function(){return this.allVideos},t.prototype.presentLoading=function(t){return e=this,void 0,o=function(){return function(t,e){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}}(this,function(e){switch(e.label){case 0:return[4,this.loadingCtrl.create({message:t,duration:500})];case 1:return[4,e.sent().present()];case 2:return e.sent(),[2]}})},new((n=void 0)||(n=Promise))(function(t,r){function i(t){try{u(o.next(t))}catch(t){r(t)}}function s(t){try{u(o.throw(t))}catch(t){r(t)}}function u(e){e.done?t(e.value):new n(function(t){t(e.value)}).then(i,s)}u((o=o.apply(e,[])).next())});var e,n,o},t.prototype.getTopvideos=function(t){return this.topVideos.slice(t,t+this.limitOffset)},t.prototype.setTopVideos=function(t){this.topVideos=t},t.prototype.addTopVideo=function(t){this.presentLoading("Setting as a top video"),t.topVideo=1,o.database().ref("/videos/"+t.key).set(t),this.topVideos.unshift(t)},t.prototype.removeTopVideo=function(t){t.topVideo=0,o.database().ref("/videos/"+t.key).set(t)},t.prototype.playVideo=function(t){t.seen=!0,this.profileService.setVideoSeen(t),window.open("https://www.youtube.com/watch?v="+t.youtubeId)},t.prototype.setType=function(t,e){var n=this;return t.type=e,this.maestroService.getMaestros().forEach(function(o){n.findVideo(t,"maestros/"+o.key+"/videos","setType",e).then()}),this.findVideo(t,"videos","setType",e).then(),!0},t.prototype.deleteVideo=function(t){var e=this;this.maestroService.getMaestros().forEach(function(n){e.findVideo(t,"maestros/"+n.key+"/videos","delete",null).then()}),this.deleteGeneralVideo(t)},t.prototype.deleteGeneralVideo=function(t){o.database().ref("videos/"+t.key).set(null),console.log("deleting video "+t.title)},t.prototype.findVideo=function(t,e,n,r){return new Promise(function(i,s){o.database().ref(e).orderByChild("youtubeId").equalTo(t.youtubeId).once("value").then(function(i){i.forEach(function(i){"delete"==n&&(t.valid=0,o.database().ref(e+"/"+i.key).set(t),console.log("deleting "+t.title)),"setType"==n&&(t.type=r,o.database().ref(e+"/"+i.key).set(t))})})})},t.ngInjectableDef=s.V({factory:function(){return new t(s.Z(u.a),s.Z(r.a),s.Z(i.a),s.Z(a.a))},token:t,providedIn:"root"}),t}()}}]);